create PROCEDURE [dbo].[SP_Supervisor_UpdateBrakeResultsLog]
    @RequestId                     INT,
    @InspectionReqId               INT,
    @BrakeReadType                 INT,
    @DescriptionAr                 NVARCHAR(MAX) = NULL,
    @DescriptionEn                 NVARCHAR(MAX) = NULL,
    @LeftValue                     DECIMAL(18, 3) = NULL,
    @RightValue                    DECIMAL(18, 3) = NULL,
    @Weight                        DECIMAL(18, 3) = NULL,
    @MaxDifference                 INT = NULL,
    @ActualDifference              INT = NULL,
    @MinDeceleration               INT = NULL,
    @ActualDeceleration            INT = NULL,
    @Location                      INT = NULL,
    @IsPassed                      BIT = NULL,
    @Result                        INT OUTPUT,
    @ErrorMessage                  NVARCHAR(MAX) OUTPUT, -- This Variable Used For Validation Error Messages
    @DBErrorMessage                NVARCHAR(MAX) OUTPUT  -- This Variable Used For Database Error Messages
AS
BEGIN
    BEGIN TRANSACTION; -- Start the transaction

    BEGIN TRY
        -- Check if the record with the given keys exists
        IF EXISTS (SELECT 1 FROM [dbo].[Brake_Results_Log] 
                   WHERE Request_Id = @RequestId 
                   AND Inspection_Req_Id = @InspectionReqId 
                   AND Brake_Read_Type = @BrakeReadType)
        BEGIN
            UPDATE [dbo].[Brake_Results_Log]
            SET
                Description_Ar = @DescriptionAr,
                Description_En = @DescriptionEn,
                Left_Value = @LeftValue,
                Right_Value = @RightValue,
                Weight = @Weight,
                Max_Difference = @MaxDifference,
                Actual_Difference = @ActualDifference,
                Min_Deceleration = @MinDeceleration,
                Actual_Deceleration = @ActualDeceleration,
                Location = @Location,
                Is_Passed = @IsPassed
            WHERE 
                Request_Id = @RequestId 
                AND Inspection_Req_Id = @InspectionReqId 
                AND Brake_Read_Type = @BrakeReadType;

            SET @Result = 1;
        END
        ELSE
        BEGIN
            SET @ErrorMessage = 'Record with Request_Id ' + CAST(@RequestId AS NVARCHAR(255)) 
                                + ', Inspection_Req_Id ' + CAST(@InspectionReqId AS NVARCHAR(255)) 
                                + ', and Brake_Read_Type ' + CAST(@BrakeReadType AS NVARCHAR(255)) + ' does not exist.';
            SET @Result = 0;
            ROLLBACK;  
            RETURN;
        END
    END TRY

    BEGIN CATCH
        SET @DBErrorMessage = ERROR_MESSAGE();
        SET @Result = 0;
        ROLLBACK;  
        RETURN;
    END CATCH;

    COMMIT;  
END;
