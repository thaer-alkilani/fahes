CREATE OR ALTER TRIGGER [dbo].[trg_Inspection_ResultsChanges]
ON [dbo].[Inspection_Results]
after INSERT, UPDATE, DELETE
AS
BEGIN
    SET NOCOUNT ON;

    IF EXISTS(SELECT * FROM inserted) AND NOT EXISTS(SELECT * FROM deleted)
    BEGIN
	INSERT INTO [dbo].[Inspection_Results_Audit]
           ([Inspection_Step_Id]
           ,[Inspection_Req_Id]
           ,[Request_Id]
           ,[Inspection_Service_Id]
           ,[Section_Id]
           ,[Defect_Mode]
           ,[Defect_Comment_Id]
           ,[Defect_Classification]
           ,[Remarks]
           ,[Status]
           ,[Defect_Source]
           ,[Evalution_Id]
           ,[Location]
           ,[Axle]
           ,[Created_By]
           ,[Created_Date]
           ,[Updated_By]
           ,[Updated_Date]
           ,[Operation_Type]
           ,[Transaction_Date])
SELECT  [Inspection_Step_Id]
      ,[Inspection_Req_Id]
      ,[Request_Id]
      ,[Inspection_Service_Id]
      ,[Section_Id]
      ,[Defect_Mode]
      ,[Defect_Comment_Id]
      ,[Defect_Classification]
      ,[Remarks]
      ,[Status]
      ,[Defect_Source]
      ,[Evalution_Id]
      ,[Location]
      ,[Axle]
      ,[Created_By]
      ,[Created_Date]
      ,[Updated_By]
      ,[Updated_Date]
	  ,'I'
	  ,Getdate()
    FROM inserted;

    END

    IF EXISTS(SELECT * FROM deleted) AND NOT EXISTS(SELECT * FROM inserted)
    BEGIN
	INSERT INTO [dbo].[Inspection_Results_Audit]
           ([Inspection_Step_Id]
           ,[Inspection_Req_Id]
           ,[Request_Id]
           ,[Inspection_Service_Id]
           ,[Section_Id]
           ,[Defect_Mode]
           ,[Defect_Comment_Id]
           ,[Defect_Classification]
           ,[Remarks]
           ,[Status]
           ,[Defect_Source]
           ,[Evalution_Id]
           ,[Location]
           ,[Axle]
           ,[Created_By]
           ,[Created_Date]
           ,[Updated_By]
           ,[Updated_Date]
           ,[Operation_Type]
           ,[Transaction_Date])
SELECT  [Inspection_Step_Id]
      ,[Inspection_Req_Id]
      ,[Request_Id]
      ,[Inspection_Service_Id]
      ,[Section_Id]
      ,[Defect_Mode]
      ,[Defect_Comment_Id]
      ,[Defect_Classification]
      ,[Remarks]
      ,[Status]
      ,[Defect_Source]
      ,[Evalution_Id]
      ,[Location]
      ,[Axle]
      ,[Created_By]
      ,[Created_Date]
      ,[Updated_By]
      ,[Updated_Date]
	  ,'D'
	  ,Getdate()
        FROM deleted;
    END

    IF EXISTS(SELECT * FROM inserted) AND EXISTS(SELECT * FROM deleted)
    BEGIN
        -- For UPDATE, insert one record with 'U'
	 INSERT INTO [dbo].[Inspection_Results_Audit]
           ([Inspection_Step_Id]
           ,[Inspection_Req_Id]
           ,[Request_Id]
           ,[Inspection_Service_Id]
           ,[Section_Id]
           ,[Defect_Mode]
           ,[Defect_Comment_Id]
           ,[Defect_Classification]
           ,[Remarks]
           ,[Status]
           ,[Defect_Source]
           ,[Evalution_Id]
           ,[Location]
           ,[Axle]
           ,[Created_By]
           ,[Created_Date]
           ,[Updated_By]
           ,[Updated_Date]
           ,[Operation_Type]
           ,[Transaction_Date])
SELECT  [Inspection_Step_Id]
      ,[Inspection_Req_Id]
      ,[Request_Id]
      ,[Inspection_Service_Id]
      ,[Section_Id]
      ,[Defect_Mode]
      ,[Defect_Comment_Id]
      ,[Defect_Classification]
      ,[Remarks]
      ,[Status]
      ,[Defect_Source]
      ,[Evalution_Id]
      ,[Location]
      ,[Axle]
      ,[Created_By]
      ,[Created_Date]
      ,[Updated_By]
      ,[Updated_Date]
	  ,'U'
	  ,Getdate()
        FROM deleted;
    END
END;
GO

ALTER TABLE [dbo].[Inspection_Results] ENABLE TRIGGER [trg_Inspection_ResultsChanges]
GO


